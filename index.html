<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶∂‡ßÅ‡¶≠ ‡ß≠‡ßØ‡¶§‡¶Æ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ß‡ßÄ‡¶®‡¶§‡¶æ ‡¶¶‡¶ø‡¶¨‡¶∏!</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Noto+Sans+Bengali:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        body {
            font-family: 'Noto Sans Bengali', 'Inter', sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #flag-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        .ashok-chakra {
            animation: spin 20s linear infinite;
        }
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .content-wrapper {
            position: relative;
            z-index: 2;
        }
        #name-modal, #horoscope-modal, #qa-modal {
            z-index: 10;
        }
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body class="p-2 sm:p-4">

    <canvas id="flag-canvas"></canvas>

    <!-- Modals -->
    <div id="name-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 text-center w-11/12 max-w-sm text-gray-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4">‡¶∂‡ßÅ‡¶≠ ‡ß≠‡ßØ‡¶§‡¶Æ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ß‡ßÄ‡¶®‡¶§‡¶æ ‡¶¶‡¶ø‡¶¨‡¶∏!</h2>
            <p class="mb-6 text-sm sm:text-base">‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶∂‡ßÅ‡¶≠‡ßá‡¶ö‡ßç‡¶õ‡¶æ ‡¶™‡ßá‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®‡•§</p>
            <input type="text" id="name-input" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶æ‡¶Æ" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button id="submit-name-button" class="w-full bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-4 rounded-lg">‡¶Ü‡¶Æ‡¶æ‡¶∞ ‡¶∂‡ßÅ‡¶≠‡ßá‡¶ö‡ßç‡¶õ‡¶æ ‡¶™‡¶æ‡¶®</button>
        </div>
    </div>
    
    <div id="horoscope-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 text-center w-11/12 max-w-sm text-gray-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∞‡¶æ‡¶∂‡¶ø‡¶´‡¶≤ ‡¶ú‡¶æ‡¶®‡ßÅ‡¶®</h2>
            <p class="mb-6 text-sm sm:text-base">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Æ‡¶§‡¶æ‡¶∞‡¶ø‡¶ñ ‡¶¶‡¶ø‡¶®‡•§</p>
            <input type="date" id="dob-input" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-4">
            <button id="submit-horoscope-button" class="w-full bg-green-700 hover:bg-green-800 text-white font-bold py-2 px-4 rounded-lg">‡¶∞‡¶æ‡¶∂‡¶ø‡¶´‡¶≤ ‡¶™‡¶æ‡¶®</button>
            <button id="close-horoscope-modal" class="w-full mt-2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>
    
    <div id="qa-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8 text-center w-11/12 max-w-sm text-gray-800">
            <h2 class="text-xl sm:text-2xl font-bold mb-4">‡¶è‡¶Ü‡¶á ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶∏‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶ü</h2>
            <p class="mb-2 text-sm sm:text-base">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ú‡¶ø‡¶ú‡ßç‡¶û‡¶æ‡¶∏‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
            <textarea id="qa-input" placeholder="‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶® ‡¶Ö‡¶•‡¶¨‡¶æ ‡¶Æ‡¶æ‡¶á‡¶ï‡ßç‡¶∞‡ßã‡¶´‡ßã‡¶®‡ßá ‡¶¨‡¶≤‡ßÅ‡¶®..." rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg mb-2"></textarea>
            <div class="flex items-center gap-2 mb-4">
                <button id="start-recognition-button" class="bg-gray-200 hover:bg-gray-300 text-gray-800 font-bold p-3 rounded-full">üé§</button>
                <p id="recognition-status" class="text-sm text-gray-500 flex-grow text-left"></p>
            </div>
            <button id="submit-qa-button" class="w-full bg-indigo-700 hover:bg-indigo-800 text-white font-bold py-2 px-4 rounded-lg">‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶® ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®</button>
            <button id="close-qa-modal" class="w-full mt-2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg">‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®</button>
        </div>
    </div>

    <!-- Main Content -->
    <div id="main-content" class="content-wrapper w-full max-w-4xl mx-auto bg-white/80 backdrop-blur-sm rounded-2xl shadow-2xl p-4 md:p-6 text-center text-gray-800 overflow-y-auto hidden max-h-full">
        <header class="relative mb-4 sm:mb-6">
             <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 opacity-10 w-40 h-40 sm:w-56 sm:h-56">
                <svg class="ashok-chakra" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><circle cx="50" cy="50" r="45" fill="none" stroke="#000080" stroke-width="2"/><circle cx="50" cy="50" r="5" fill="#000080"/><g stroke="#000080" stroke-width="1"><path d="M50 5 L50 95" /><path d="M5 50 L95 50" /><path d="M14.6 14.6 L85.4 85.4" /><path d="M14.6 85.4 L85.4 14.6" /><path d="M29.3 7.7 L70.7 92.3" /><path d="M7.7 29.3 L92.3 70.7" /><path d="M7.7 70.7 L92.3 29.3" /><path d="M29.3 92.3 L70.7 7.7" /><path d="M50 5 a 45 45 0 0 1 35.3 17.6 l -3.5 -6.1" /><path d="M50 5 a 45 45 0 0 1 43.3 35.3 l -6.1 -3.5" /><path d="M50 95 a 45 45 0 0 1 -35.3 -17.6 l 3.5 6.1" /><path d="M50 95 a 45 45 0 0 1 -43.3 -35.3 l 6.1 3.5" /><path d="M95 50 a 45 45 0 0 1 -17.6 35.3 l -6.1 -3.5" /><path d="M95 50 a 45 45 0 0 1 -35.3 43.3 l -3.5 -6.1" /><path d="M5 50 a 45 45 0 0 1 17.6 -35.3 l 6.1 3.5" /><path d="M5 50 a 45 45 0 0 1 35.3 -43.3 l 3.5 6.1" /></g></svg>
            </div>
            <h1 id="main-greeting" class="text-2xl sm:text-3xl md:text-5xl font-black text-orange-600 drop-shadow-lg"></h1>
            <p class="text-sm sm:text-base md:text-lg mt-2 text-blue-800 font-semibold">‡¶∏‡ßç‡¶¨‡¶æ‡¶ß‡ßÄ‡¶®‡¶§‡¶æ, ‡¶è‡¶ï‡¶§‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶Ö‡¶ó‡ßç‡¶∞‡¶ó‡¶§‡¶ø‡¶∞ ‡¶â‡¶¶‡¶Ø‡¶æ‡¶™‡¶®</p>
        </header>

        <main class="space-y-3 sm:space-y-4">
            <div class="p-3 sm:p-4 bg-orange-100/50 rounded-lg"><p class="text-xs sm:text-base">"‡¶Æ‡¶®‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ß‡ßÄ‡¶®‡¶§‡¶æ, ‡¶ï‡¶•‡¶æ‡¶Ø‡¶º ‡¶¨‡¶ø‡¶∂‡ßç‡¶¨‡¶æ‡¶∏, ‡¶Ü‡¶§‡ßç‡¶Æ‡¶æ‡¶Ø‡¶º ‡¶ó‡¶∞‡ßç‡¶¨‡•§ ‡¶Ü‡¶∏‡ßÅ‡¶® ‡¶è‡¶á ‡¶∂‡ßÅ‡¶≠ ‡¶¶‡¶ø‡¶®‡ßá ‡¶ú‡¶æ‡¶§‡¶ø‡¶ï‡ßá ‡¶∏‡ßç‡¶Ø‡¶æ‡¶≤‡ßÅ‡¶ü ‡¶ú‡¶æ‡¶®‡¶æ‡¶á‡•§ ‡¶ú‡¶Ø‡¶º ‡¶π‡¶ø‡¶®‡ßç‡¶¶!"</p></div>
            <div class="p-3 sm:p-4 bg-green-100/50 rounded-lg"><p class="text-xs sm:text-base">"‡¶≠‡¶æ‡¶∞‡¶§‡ßá‡¶∞ ‡¶§‡ßá‡¶∞‡¶ô‡ßç‡¶ó‡¶æ ‡¶Ø‡ßá‡¶® ‡¶∏‡¶∞‡ßç‡¶¨‡¶¶‡¶æ ‡¶â‡¶Å‡¶ö‡ßÅ‡¶§‡ßá ‡¶ì‡¶°‡¶º‡ßá‡•§ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ß‡ßÄ‡¶®‡¶§‡¶æ ‡¶¶‡¶ø‡¶¨‡¶∏‡ßá‡¶∞ ‡¶è‡¶á ‡¶Æ‡¶π‡¶æ‡¶® ‡¶Ö‡¶®‡ßÅ‡¶∑‡ßç‡¶†‡¶æ‡¶®‡ßá ‡¶Ü‡¶®‡ßç‡¶§‡¶∞‡¶ø‡¶ï ‡¶∂‡ßÅ‡¶≠‡ßá‡¶ö‡ßç‡¶õ‡¶æ‡•§"</p></div>
            <div class="p-3 sm:p-4 bg-blue-100/50 rounded-lg"><p class="text-xs sm:text-base">"‡¶è‡¶á ‡¶¶‡¶ø‡¶®‡ßá, ‡¶Ü‡¶∏‡ßÅ‡¶® ‡¶Ü‡¶Æ‡¶∞‡¶æ ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Æ‡ßÅ‡¶ï‡ßç‡¶§‡¶ø‡¶Ø‡ßã‡¶¶‡ßç‡¶ß‡¶æ‡¶¶‡ßá‡¶∞ ‡¶Ü‡¶§‡ßç‡¶Æ‡¶§‡ßç‡¶Ø‡¶æ‡¶ó ‡¶∏‡ßç‡¶Æ‡¶∞‡¶£ ‡¶ï‡¶∞‡¶ø ‡¶è‡¶¨‡¶Ç ‡¶è‡¶Æ‡¶® ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≠‡¶æ‡¶∞‡¶§ ‡¶ó‡¶°‡¶º‡¶æ‡¶∞ ‡¶∂‡¶™‡¶• ‡¶ï‡¶∞‡¶ø ‡¶Ø‡¶æ ‡¶®‡¶ø‡¶Ø‡¶º‡ßá ‡¶§‡¶æ‡¶∞‡¶æ ‡¶ó‡¶∞‡ßç‡¶¨‡¶ø‡¶§ ‡¶π‡¶¨‡ßá‡•§"</p></div>
        </main>

        <footer class="mt-4 sm:mt-6">
            <div class="flex flex-wrap items-center justify-center gap-3 sm:gap-4">
                <button id="music-button" class="bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-5 rounded-full shadow-lg text-sm sm:text-base">‡¶¶‡ßá‡¶∂‡¶æ‡¶§‡ßç‡¶Æ‡¶¨‡ßã‡¶ß‡¶ï ‡¶∏‡¶ô‡ßç‡¶ó‡ßÄ‡¶§ ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®</button>
                <button id="gemini-talk-button" class="bg-purple-700 hover:bg-purple-800 text-white font-bold py-2 px-5 rounded-full shadow-lg text-sm sm:text-base font-sans">Message from Kanan</button>
                <button id="horoscope-button" class="bg-green-700 hover:bg-green-800 text-white font-bold py-2 px-5 rounded-full shadow-lg text-sm sm:text-base">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∞‡¶æ‡¶∂‡¶ø‡¶´‡¶≤</button>
                <button id="ai-assistant-button" class="bg-indigo-700 hover:bg-indigo-800 text-white font-bold py-2 px-5 rounded-full shadow-lg text-sm sm:text-base font-sans">AI Assistant</button>
            </div>
            <div id="gemini-status" class="text-xs sm:text-sm text-gray-600 mt-2 h-5"></div>
        </footer>
        
        <footer class="mt-4 sm:mt-6 border-t pt-4 text-gray-600 font-sans">
            <div class="flex flex-col items-center text-center space-y-2">
                <p class="font-bold text-lg sm:text-xl text-gray-800">Kanan Pandit</p>
                <p class="text-xs sm:text-sm italic">Aspiring Data Scientist & AI Enthusiast</p>
                <div class="flex flex-wrap justify-center items-center space-x-3 sm:space-x-5 text-sm sm:text-base">
                    <a href="https://kananpanditportfolio.netlify.app" target="_blank" class="flex items-center space-x-1 hover:text-blue-700"><span>üåê</span> <span>Portfolio</span></a>
                    <a href="https://www.linkedin.com/in/kananpandit02" target="_blank" class="flex items-center space-x-1 hover:text-blue-700"><span>üîó</span> <span>LinkedIn</span></a>
                    <a href="https://github.com/kananpandit02" target="_blank" class="flex items-center space-x-1 hover:text-blue-700"><span>üíª</span> <span>GitHub</span></a>
                </div>
                <div class="text-xs sm:text-sm space-y-1">
                    <p>üìß Email: <a href="mailto:kananpandit02@gmail.com" class="hover:underline">kananpandit02@gmail.com</a></p>
                    <p>üì± Phone: <a href="tel:+917384661310" class="hover:underline">+91 7384661310</a></p>
                </div>
                <p class="text-xs mt-2">Made with ‚ù§Ô∏è by <span class="font-semibold">Kanan Pandit</span></p>
                <button id="change-name-button" class="w-full sm:w-auto bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-5 rounded-full shadow-lg text-sm sm:text-base mt-4">‡¶®‡¶æ‡¶Æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</button>
            </div>
        </footer>
    </div>

    <script>
        // --- DOM Elements ---
        const nameModal = document.getElementById('name-modal');
        const nameInput = document.getElementById('name-input');
        const submitNameButton = document.getElementById('submit-name-button');
        const mainContent = document.getElementById('main-content');
        const mainGreeting = document.getElementById('main-greeting');
        const musicButton = document.getElementById('music-button');
        const geminiTalkButton = document.getElementById('gemini-talk-button');
        const geminiStatus = document.getElementById('gemini-status');
        const horoscopeButton = document.getElementById('horoscope-button');
        const horoscopeModal = document.getElementById('horoscope-modal');
        const dobInput = document.getElementById('dob-input');
        const submitHoroscopeButton = document.getElementById('submit-horoscope-button');
        const closeHoroscopeModalButton = document.getElementById('close-horoscope-modal');
        const aiAssistantButton = document.getElementById('ai-assistant-button');
        const qaModal = document.getElementById('qa-modal');
        const qaInput = document.getElementById('qa-input');
        const submitQaButton = document.getElementById('submit-qa-button');
        const closeQaModalButton = document.getElementById('close-qa-modal');
        const startRecognitionButton = document.getElementById('start-recognition-button');
        const recognitionStatus = document.getElementById('recognition-status');
        const changeNameButton = document.getElementById('change-name-button');
        
        // --- Personalization & Modal Logic ---
        function showPersonalizedView(name) {
            mainGreeting.textContent = `‡ß≠‡ßØ‡¶§‡¶Æ ‡¶∂‡ßÅ‡¶≠ ‡¶∏‡ßç‡¶¨‡¶æ‡¶ß‡ßÄ‡¶®‡¶§‡¶æ ‡¶¶‡¶ø‡¶¨‡¶∏, ${name}!`;
            nameModal.classList.add('hidden');
            mainContent.classList.remove('hidden');
        }

        submitNameButton.addEventListener('click', () => {
            const name = nameInput.value.trim();
            if (name) {
                localStorage.setItem('visitorName', name);
                showPersonalizedView(name);
            }
        });
        
        nameInput.addEventListener('keyup', (event) => { if (event.key === 'Enter') submitNameButton.click(); });

        window.addEventListener('load', () => {
            const savedName = localStorage.getItem('visitorName');
            if (savedName) showPersonalizedView(savedName);
            else nameModal.classList.remove('hidden');
        });

        changeNameButton.addEventListener('click', () => {
            localStorage.removeItem('visitorName');
            mainContent.classList.add('hidden');
            nameModal.classList.remove('hidden');
            nameInput.value = '';
            nameInput.focus();
        });

        // --- Tone.js Music Logic ---
        let musicPlaying = false;
        const synth = new Tone.Synth({ oscillator: { type: 'sine' }, envelope: { attack: 0.005, decay: 0.1, sustain: 0.3, release: 1 } }).toDestination();
        const melody = [ { time: '0:0', note: 'E4', duration: '8n' }, { time: '0:0:2', note: 'F#4', duration: '8n' }, { time: '0:1', note: 'G4', duration: '4n' }, { time: '0:2', note: 'G4', duration: '8n' }, { time: '0:2:2', note: 'G4', duration: '8n' }, { time: '0:3', note: 'G4', duration: '4n' }, { time: '1:0', note: 'G4', duration: '8n' }, { time: '1:0:2', note: 'F#4', duration: '8n' }, { time: '1:1', note: 'E4', duration: '4n' }, { time: '1:2', note: 'D4', duration: '4n' }, { time: '1:3', note: 'E4', duration: '4n' }, { time: '2:0', note: 'E4', duration: '8n' }, { time: '2:0:2', note: 'F#4', duration: '8n' }, { time: '2:1', note: 'G4', duration: '4n' }, { time: '2:2', note: 'G4', duration: '8n' }, { time: '2:2:2', note: 'G4', duration: '8n' }, { time: '2:3', note: 'G4', duration: '4n' }, { time: '3:0', note: 'A4', duration: '4n' }, { time: '3:1', note: 'B4', duration: '4n' }, { time: '3:2', note: 'A4', duration: '4n' }, { time: '3:3', note: 'G4', duration: '4n' }, { time: '4:0', note: 'C5', duration: '4n' }, { time: '4:1', note: 'C5', duration: '4n' }, { time: '4:2', note: 'B4', duration: '4n' }, { time: '4:3', note: 'A4', duration: '4n' }, { time: '5:0', note: 'G4', duration: '2n' }, { time: '5:2', note: 'A4', duration: '2n' }, { time: '6:0', note: 'B4', duration: '4n' }, { time: '6:1', note: 'B4', duration: '4n' }, { time: '6:2', note: 'A4', duration: '4n' }, { time: '6:3', note: 'G4', duration: '4n' }, { time: '7:0', note: 'F#4', duration: '2n' }, { time: '7:2', note: 'G4', duration: '2n' } ];
        const part = new Tone.Part((time, value) => { synth.triggerAttackRelease(value.note, value.duration, time); }, melody).start(0);
        part.loop = true; part.loopStart = 0; part.loopEnd = '8m';
        Tone.Transport.pause(); // Start paused

        musicButton.addEventListener('click', async () => {
            if (Tone.context.state !== 'running') await Tone.start();
            if (!musicPlaying) {
                Tone.Transport.start();
                musicButton.textContent = '‡¶∏‡¶ô‡ßç‡¶ó‡ßÄ‡¶§ ‡¶ö‡¶≤‡¶õ‡ßá...';
                musicPlaying = true;
            } else {
                Tone.Transport.pause();
                musicButton.textContent = '‡¶∏‡¶ô‡ßç‡¶ó‡ßÄ‡¶§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡¶æ‡¶≤‡¶æ‡¶®';
                musicPlaying = false;
            }
        });

        // --- Gemini TTS and Text Generation ---
        async function getAndSpeak(textGenPrompt) {
            let wasMusicPlaying = musicPlaying;
            const allButtons = [geminiTalkButton, musicButton, horoscopeButton, aiAssistantButton, changeNameButton];
            allButtons.forEach(btn => btn.disabled = true);
            if (wasMusicPlaying) Tone.Transport.pause();

            try {
                geminiStatus.textContent = '‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
                let textPayload = { contents: [{ role: "user", parts: [{ text: textGenPrompt }] }] };
                const apiKey = "AIzaSyCT3lE9Qotl86whCPCykj6WE05SBuaLqFo";
                let textApiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
                
                let response = await fetch(textApiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(textPayload) });
                if (!response.ok) throw new Error(`Text generation failed`);
                let result = await response.json();
                const generatedText = result?.candidates?.[0]?.content?.parts?.[0]?.text;
                if (!generatedText) throw new Error("Could not get text from Gemini.");

                geminiStatus.textContent = '‡¶¨‡¶≤‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...';
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(generatedText);
                    utterance.lang = 'bn-IN';
                    utterance.onend = () => {
                        geminiStatus.textContent = '';
                        if (wasMusicPlaying) Tone.Transport.start();
                        allButtons.forEach(btn => btn.disabled = false);
                    };
                    speechSynthesis.speak(utterance);
                } else {
                    throw new Error("Browser does not support Speech Synthesis.");
                }

            } catch (error) {
                console.error("Error with Gemini feature:", error);
                let errorMessage = '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§';
                if (error.message.includes("API key")) {
                    errorMessage = 'API ‡¶ï‡ßÄ ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡ßü‡•§';
                }
                geminiStatus.textContent = errorMessage;
                setTimeout(() => {
                    geminiStatus.textContent = '';
                    if (wasMusicPlaying) Tone.Transport.start();
                    allButtons.forEach(btn => btn.disabled = false);
                }, 3000);
            }
        }

        geminiTalkButton.addEventListener('click', () => {
            const visitorName = localStorage.getItem('visitorName') || '‡¶¨‡¶®‡ßç‡¶ß‡ßÅ';
            const prompt = `‡¶ï‡¶æ‡¶®‡¶® ‡¶™‡¶®‡ßç‡¶°‡¶ø‡¶§-‡¶è‡¶∞ ‡¶™‡¶ï‡ßç‡¶∑ ‡¶•‡ßá‡¶ï‡ßá ${visitorName}-‡¶ï‡ßá ‡¶∏‡ßç‡¶¨‡¶æ‡¶ß‡ßÄ‡¶®‡¶§‡¶æ ‡¶¶‡¶ø‡¶¨‡¶∏‡ßá‡¶∞ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§, ‡¶¨‡ßç‡¶Ø‡¶ï‡ßç‡¶§‡¶ø‡¶ó‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶â‡ßé‡¶∏‡¶æ‡¶π‡¶¨‡ßç‡¶Ø‡¶û‡ßç‡¶ú‡¶ï ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ ‡¶¶‡¶ø‡¶®‡•§ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ‡¶ü‡¶ø‡¶∞ ‡¶∂‡ßá‡¶∑‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®, '‡¶Ü‡¶Æ‡¶ø ‡¶ï‡¶æ‡¶®‡¶® ‡¶™‡¶®‡ßç‡¶°‡¶ø‡¶§‡ßá‡¶∞ ‡¶¶‡ßç‡¶¨‡¶æ‡¶∞‡¶æ ‡¶™‡ßç‡¶∞‡¶∂‡¶ø‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶è‡¶ï‡¶ú‡¶® ‡¶ï‡ßÉ‡¶§‡ßç‡¶∞‡¶ø‡¶Æ ‡¶∏‡¶π‡¶ï‡¶æ‡¶∞‡ßÄ‡•§'`;
            getAndSpeak(prompt);
        });

        horoscopeButton.addEventListener('click', () => { horoscopeModal.classList.remove('hidden'); });
        closeHoroscopeModalButton.addEventListener('click', () => { horoscopeModal.classList.add('hidden'); });

        function getZodiacSign(date) {
            const day = date.getDate(); const month = date.getMonth() + 1;
            if ((month == 1 && day >= 20) || (month == 2 && day <= 18)) return "‡¶ï‡ßÅ‡¶Æ‡ßç‡¶≠"; if ((month == 2 && day >= 19) || (month == 3 && day <= 20)) return "‡¶Æ‡ßÄ‡¶®"; if ((month == 3 && day >= 21) || (month == 4 && day <= 19)) return "‡¶Æ‡ßá‡¶∑"; if ((month == 4 && day >= 20) || (month == 5 && day <= 20)) return "‡¶¨‡ßÉ‡¶∑"; if ((month == 5 && day >= 21) || (month == 6 && day <= 20)) return "‡¶Æ‡¶ø‡¶•‡ßÅ‡¶®"; if ((month == 6 && day >= 21) || (month == 7 && day <= 22)) return "‡¶ï‡¶∞‡ßç‡¶ï‡¶ü"; if ((month == 7 && day >= 23) || (month == 8 && day <= 22)) return "‡¶∏‡¶ø‡¶Ç‡¶π"; if ((month == 8 && day >= 23) || (month == 9 && day <= 22)) return "‡¶ï‡¶®‡ßç‡¶Ø‡¶æ"; if ((month == 9 && day >= 23) || (month == 10 && day <= 22)) return "‡¶§‡ßÅ‡¶≤‡¶æ"; if ((month == 10 && day >= 23) || (month == 11 && day <= 21)) return "‡¶¨‡ßÉ‡¶∂‡ßç‡¶ö‡¶ø‡¶ï"; if ((month == 11 && day >= 22) || (month == 12 && day <= 21)) return "‡¶ß‡¶®‡ßÅ"; if ((month == 12 && day >= 22) || (month == 1 && day <= 19)) return "‡¶Æ‡¶ï‡¶∞";
        }

        submitHoroscopeButton.addEventListener('click', () => {
            const dob = dobInput.value;
            if (dob) {
                const zodiacSign = getZodiacSign(new Date(dob));
                horoscopeModal.classList.add('hidden');
                const visitorName = localStorage.getItem('visitorName') || '‡¶¨‡¶®‡ßç‡¶ß‡ßÅ';
                const prompt = `‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ${visitorName}-‡¶è‡¶∞ ‡¶∞‡¶æ‡¶∂‡¶ø‡¶´‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶Ø‡¶æ‡¶∞ ‡¶∞‡¶æ‡¶∂‡¶ø ${zodiacSign}‡•§ ‡¶è‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡¶ø‡¶™‡ßç‡¶§ ‡¶è‡¶¨‡¶Ç ‡¶á‡¶§‡¶ø‡¶¨‡¶æ‡¶ö‡¶ï ‡¶∞‡¶æ‡¶ñ‡ßÅ‡¶®‡•§`;
                getAndSpeak(prompt);
            }
        });

        // --- Q&A and Speech Recognition Logic ---
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition;

        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false; recognition.lang = 'bn-IN'; recognition.interimResults = false;
            recognition.onstart = () => { recognitionStatus.textContent = '‡¶∂‡ßÅ‡¶®‡¶õ‡¶ø...'; startRecognitionButton.classList.add('bg-red-500'); };
            recognition.onresult = (event) => { qaInput.value = event.results[0][0].transcript; };
            recognition.onerror = (event) => { 
                console.error("Speech recognition error", event.error); 
                if (event.error === 'no-speech') {
                    recognitionStatus.textContent = '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡¶•‡¶æ ‡¶∂‡ßã‡¶®‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø‡•§';
                } else {
                    recognitionStatus.textContent = '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶ï‡¶ü‡¶ø ‡¶§‡ßç‡¶∞‡ßÅ‡¶ü‡¶ø ‡¶ò‡¶ü‡ßá‡¶õ‡ßá‡•§';
                }
            };
            recognition.onend = () => { 
                if (recognitionStatus.textContent === '‡¶∂‡ßÅ‡¶®‡¶õ‡¶ø...') {
                    recognitionStatus.textContent = '';
                }
                startRecognitionButton.classList.remove('bg-red-500'); 
            };
            startRecognitionButton.addEventListener('click', () => recognition.start());
        } else {
            startRecognitionButton.disabled = true;
            recognitionStatus.textContent = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡ßç‡¶∞‡¶æ‡¶â‡¶ú‡¶æ‡¶∞ ‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶∏‡¶Æ‡¶∞‡ßç‡¶•‡¶® ‡¶ï‡¶∞‡ßá ‡¶®‡¶æ‡•§";
        }

        aiAssistantButton.addEventListener('click', () => { qaModal.classList.remove('hidden'); });
        closeQaModalButton.addEventListener('click', () => { qaModal.classList.add('hidden'); });
        
        submitQaButton.addEventListener('click', () => {
            const question = qaInput.value.trim();
            if (question) {
                qaModal.classList.add('hidden');
                const creatorKeywords = ["‡¶ï‡ßá ‡¶¨‡¶æ‡¶®‡¶ø‡¶Ø‡¶º‡ßá‡¶õ‡ßá", "‡¶ï‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá‡¶õ‡ßá", "‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶∏‡ßç‡¶∞‡¶∑‡ßç‡¶ü‡¶æ", "who made you", "who created you", "your creator"];
                const isCreatorQuery = creatorKeywords.some(keyword => question.toLowerCase().includes(keyword));
                let promptForGemini = isCreatorQuery ? "Politely answer in Bengali that you are an AI assistant trained by Kanan Pandit." : question;
                getAndSpeak(promptForGemini);
                qaInput.value = '';
            }
        });

        // --- Animated Flag Background ---
        const flagCanvas = document.getElementById('flag-canvas');
        const flagCtx = flagCanvas.getContext('2d');
        let time = 0;

        function resizeCanvas() {
            flagCanvas.width = window.innerWidth;
            flagCanvas.height = window.innerHeight;
        }

        function drawWavingFlag() {
            const width = flagCanvas.width;
            const height = flagCanvas.height;
            const stripeHeight = height / 3;

            flagCtx.clearRect(0, 0, width, height);

            // Saffron
            flagCtx.fillStyle = '#FF9933';
            drawWavyRect(0, 0, width, stripeHeight);

            // White
            flagCtx.fillStyle = '#FFFFFF';
            drawWavyRect(0, stripeHeight, width, stripeHeight);

            // Green
            flagCtx.fillStyle = '#138808';
            drawWavyRect(0, stripeHeight * 2, width, stripeHeight);
            
            // Ashok Chakra
            drawAshokChakra(width / 2, height / 2);

            time += 0.02;
            requestAnimationFrame(drawWavingFlag);
        }

        function drawWavyRect(x, y, w, h) {
            const amplitude = 15;
            const frequency = 0.01;
            
            flagCtx.beginPath();
            flagCtx.moveTo(x, y);

            for (let i = x; i < x + w; i++) {
                flagCtx.lineTo(i, y + Math.sin(i * frequency + time) * amplitude);
            }
            flagCtx.lineTo(x + w, y + h);
            for (let i = x + w; i > x; i--) {
                flagCtx.lineTo(i, y + h + Math.sin(i * frequency + time) * amplitude);
            }
            flagCtx.closePath();
            flagCtx.fill();
        }

        function drawAshokChakra(x, y) {
            const radius = Math.min(flagCanvas.height / 8, 40);
            flagCtx.save();
            flagCtx.translate(x, y + Math.sin(x * 0.01 + time) * 15);
            flagCtx.strokeStyle = '#000080';
            flagCtx.lineWidth = 2;
            
            // Outer circle
            flagCtx.beginPath();
            flagCtx.arc(0, 0, radius, 0, 2 * Math.PI);
            flagCtx.stroke();

            // 24 spokes
            for (let i = 0; i < 24; i++) {
                flagCtx.beginPath();
                flagCtx.moveTo(0, 0);
                flagCtx.lineTo(radius * Math.cos(i * Math.PI / 12), radius * Math.sin(i * Math.PI / 12));
                flagCtx.stroke();
            }
            flagCtx.restore();
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();
        drawWavingFlag();

    </script>

</body>
</html>
